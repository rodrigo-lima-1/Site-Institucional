<!-- EVENTOS PAGE -->
<link rel="stylesheet" href="src/styles/eventos.css">
<div class="page-content" id="eventos-page">
  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Eventos</h1>
        <p class="hero-subtitle">
          Participe dos nossos workshops, palestras e eventos para se manter atualizado 
          com as Ãºltimas tendÃªncias em tecnologia e networking.
        </p>
      </div>
    </div>
  </section>

  <!-- Filtros Section -->
  <section class="section" id="filtros-section">
    <div class="container">
      <div class="filters-container">
        <button class="filter-btn active" data-filter="all" onclick="filterEvents('all')">
          Todos os Eventos
        </button>
        <button class="filter-btn" data-filter="upcoming" onclick="filterEvents('upcoming')">
          PrÃ³ximos Eventos
        </button>
        <button class="filter-btn" data-filter="past" onclick="filterEvents('past')">
          Eventos Passados
        </button>
        <button class="filter-btn" data-filter="workshop" onclick="filterEvents('workshop')">
          Workshops
        </button>
        <button class="filter-btn" data-filter="palestra" onclick="filterEvents('palestra')">
          Palestras
        </button>
      </div>
    </div>
  </section>

  <!-- PrÃ³ximos Eventos Section -->
  <section class="section" id="upcoming-events-section">
    <div class="container">
      <h2 class="section-title">PrÃ³ximos Eventos</h2>
      <p class="section-subtitle">
        NÃ£o perca as oportunidades de aprendizado e networking que preparamos para vocÃª.
      </p>
      <div id="upcoming-events-container">
        <!-- Eventos futuros serÃ£o carregados dinamicamente -->
      </div>
    </div>
  </section> 

  <!-- Eventos Passados Section -->
  <section class="section" id="past-events-section">
    <div class="container">
      <h2 class="section-title">Eventos Anteriores</h2>
      <p class="section-subtitle">
        Relembre alguns dos nossos eventos passados e veja o impacto que causaram na comunidade.
      </p>
      <div id="past-events-container">
        <!-- Eventos passados serÃ£o carregados dinamicamente -->
      </div>
    </div>
  </section>

  <!-- Newsletter Section -->
  <section class="section" id="newsletter-section">
    <div class="container text-center">
      <h2 class="section-title">Fique Por Dentro dos PrÃ³ximos Eventos</h2>
      <p class="section-subtitle">
        Inscreva-se em nossa newsletter e seja o primeiro a saber sobre novos workshops,
        palestras e oportunidades de aprendizado.
      </p>
      <div class="newsletter-form">
        <form id="newsletter-form">
          <input
            type="email"
            id="newsletter-email"
            placeholder="Seu melhor e-mail"
            required
          >
          <button
            type="submit"
            class="btn"
          >
            Inscrever-se
          </button>
        </form>
        <p>
          Prometemos nÃ£o enviar spam. VocÃª pode cancelar a inscriÃ§Ã£o a qualquer momento.
        </p>
      </div>
    </div>
  </section>
</div>



<script type="module">
import eventosContent from '/src/data/eventos_content.js';

// â­ VARIÃVEIS GLOBAIS
var allEvents = [];
var currentEventFilter = 'all';

// â­ FUNÃ‡ÃƒO DE ESPERA MELHORADA
function waitForReady(callback) {
  // Verificar se os containers existem
  const checkContainers = () => {
    const upcomingContainer = document.getElementById('upcoming-events-container');
    const pastContainer = document.getElementById('past-events-container');
    
    if (upcomingContainer && pastContainer) {
      console.log('âœ… Containers encontrados, inicializando...');
      callback();
    } else {
      console.log('â³ Aguardando containers...');
      setTimeout(checkContainers, 100);
    }
  };
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkContainers);
  } else {
    checkContainers();
  }
}

// â­ GARANTIR QUE VALIDATIONUTILS EXISTE
if (!window.ValidationUtils) {
  window.ValidationUtils = {
    isValidEmail: function(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    },
    isValidPhone: function(phone) {
      const phoneRegex = /^[\d\s\-\(\)]+$/;
      return phoneRegex.test(phone) && phone.replace(/\D/g, '').length >= 10;
    }
  };
}

// â­ EXPOR FUNÃ‡Ã•ES GLOBALMENTE
window.loadAllEvents = loadAllEvents;
window.setupNewsletterForm = setupNewsletterForm;
window.observeElements = observeElements;
window.filterEvents = filterEvents;
window.registerForEvent = registerForEvent;
window.viewEventGallery = viewEventGallery;

// â­ INICIALIZAR QUANDO PRONTO
waitForReady(function() {
  console.log('ğŸ‰ Eventos: Inicializando...');
  loadAllEvents();
  setupNewsletterForm();
  observeElements();
});

function loadAllEvents() {
  console.log('ğŸ“… Carregando eventos...');
  
  const upcomingEvents = (eventosContent.upcomingEvents?.events || []).map(e => ({ 
    ...e,
    type: e.title.toLowerCase().includes('workshop') ? 'workshop' :
          e.title.toLowerCase().includes('palestra') ? 'palestra' :
          e.title.toLowerCase().includes('hackathon') ? 'hackathon' :
          e.title.toLowerCase().includes('feira') ? 'feira' : 'outro',
    status: 'upcoming'
  }));

  const pastEvents = (eventosContent.pastEvents?.events || []).map(e => ({
    ...e,
    type: e.title.toLowerCase().includes('bootcamp') ? 'workshop' :
          e.title.toLowerCase().includes('feira') ? 'feira' : 'outro',
    status: 'past'
  }));

  allEvents = [...upcomingEvents, ...pastEvents];
  console.log('ğŸ“Š Total de eventos:', allEvents.length);
  renderEvents();
}

function renderEvents() {
  console.log('ğŸ¨ Renderizando eventos - filtro:', currentEventFilter);
  
  const upcomingContainer = document.getElementById('upcoming-events-container');
  const pastContainer = document.getElementById('past-events-container');
  
  if (!upcomingContainer || !pastContainer) {
    console.warn('âš ï¸ Containers nÃ£o encontrados');
    return;
  }

  const filteredEvents = filterEventsByType(allEvents, currentEventFilter);
  const upcomingEvents = filteredEvents.filter(ev => ev.status === 'upcoming');
  const pastEvents = filteredEvents.filter(ev => ev.status === 'past');

  // Tentar usar cardComponent se disponÃ­vel
  if (window.cardComponent && typeof window.cardComponent.renderCardGrid === 'function') {
    try {
      upcomingContainer.innerHTML = window.cardComponent.renderCardGrid(upcomingEvents, 'event', 3);
      pastContainer.innerHTML = window.cardComponent.renderCardGrid(pastEvents, 'event', 3);
      console.log('âœ… Renderizado com cardComponent');
    } catch (err) {
      console.warn('âš ï¸ cardComponent falhou, usando fallback', err);
      upcomingContainer.innerHTML = upcomingEvents.map(ev => renderEventCard(ev)).join('');
      pastContainer.innerHTML = pastEvents.map(ev => renderEventCard(ev)).join('');
    }
  } else {
    upcomingContainer.innerHTML = upcomingEvents.map(ev => renderEventCard(ev)).join('');
    pastContainer.innerHTML = pastEvents.map(ev => renderEventCard(ev)).join('');
    console.log('âœ… Renderizado com renderEventCard');
  }

  // Mostrar/ocultar seÃ§Ãµes
  const upcomingSection = document.getElementById('upcoming-events-section');
  const pastSection = document.getElementById('past-events-section');
  if (upcomingSection && pastSection) {
    upcomingSection.classList.toggle('hidden', upcomingEvents.length === 0 && currentEventFilter !== 'upcoming');
    pastSection.classList.toggle('hidden', pastEvents.length === 0 && currentEventFilter !== 'past');
  }
  
  console.log('ğŸ“ˆ Eventos renderizados:', { upcoming: upcomingEvents.length, past: pastEvents.length });
}

function renderEventCard(event) {
  const typeLabels = {
    workshop: 'Workshop',
    palestra: 'Palestra',
    hackathon: 'Hackathon',
    feira: 'Feira'
  };

  return `
    <div class="card event-card fade-in">
      <div class="event-type-badge">${typeLabels[event.type] || event.type}</div>
      <div class="event-date-badge">${event.date}</div>
      <img src="${event.image}" alt="${event.title}" class="card-image" loading="lazy">
      <div class="card-content">
        <h3 class="card-title">${event.title}</h3>
        <div class="card-meta">
          <span>ğŸ•’ ${event.time}</span>
          <span>ğŸ“ ${event.location}</span>
          <span class="event-status ${event.status}">
            ${event.status === 'upcoming' ? 'ğŸ“… PrÃ³ximo' : 'âœ… Realizado'}
          </span>
        </div>
        <p class="card-description">${event.description}</p>
        <div class="card-actions">
          ${event.status === 'upcoming' ? 
            `<button class="btn btn-primary" onclick="registerForEvent('${event.id}')">
              Inscrever-se
            </button>` :
            `<button class="btn btn-outline" onclick="viewEventGallery('${event.id}')">
              Ver Galeria
            </button>`
          }
        </div>
      </div>
    </div>
  `;
}

function filterEventsByType(events, filter) {
  if (filter === 'all') return events;
  if (filter === 'upcoming' || filter === 'past') {
    return events.filter(event => event.status === filter);
  }
  return events.filter(event => event.type === filter);
}

function filterEvents(filter) {
  currentEventFilter = filter;
  
  // Atualizar botÃµes ativos
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  const activeBtn = document.querySelector(`[data-filter="${filter}"]`);
  if (activeBtn) activeBtn.classList.add('active');
  
  // Re-renderizar eventos
  renderEvents();
}

function registerForEvent(eventId) {
  alert(`Redirecionando para inscriÃ§Ã£o do evento ${eventId}...`);
  // Implementar navegaÃ§Ã£o para formulÃ¡rio de inscriÃ§Ã£o
}

function viewEventGallery(eventId) {
  alert(`Abrindo galeria do evento ${eventId}...`);
  // Implementar modal com fotos do evento
}

function setupNewsletterForm() {
  const form = document.getElementById('newsletter-form');
  if (!form) {
    console.warn('âš ï¸ FormulÃ¡rio de newsletter nÃ£o encontrado');
    return;
  }
  
  console.log('ğŸ“§ Newsletter form configurado');
  
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('newsletter-email').value;
    
    if (!window.ValidationUtils.isValidEmail(email)) {
      alert('Por favor, insira um e-mail vÃ¡lido.');
      return;
    }
    
    alert('Obrigado! VocÃª foi inscrito em nossa newsletter.');
    form.reset();
  });
}

function observeElements() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
        entry.target.style.transform = 'translateY(0)';
      }
    });
  }, {
    threshold: 0.1
  });
  
  document.querySelectorAll('.fade-in').forEach(el => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(20px)';
    el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
    observer.observe(el);
  });
  
  console.log('ğŸ‘ï¸ Observer configurado');
}
</script>